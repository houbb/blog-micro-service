import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-BS2-Vf28.js";const l={};function p(t,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h2 id="可观察性-监控、日志与追踪的全方位洞察" tabindex="-1"><a class="header-anchor" href="#可观察性-监控、日志与追踪的全方位洞察"><span>可观察性：监控、日志与追踪的全方位洞察</span></a></h2><p>在复杂的微服务架构中，系统的可观察性是确保系统稳定运行和快速故障排查的关键。服务网格通过提供全面的可观察性功能，包括监控指标、日志收集和分布式追踪，帮助运维人员和开发者深入了解系统的运行状态。本章将深入探讨这些可观察性功能的实现原理、配置方法以及最佳实践。</p><h3 id="监控指标-系统运行状态的量化表征" tabindex="-1"><a class="header-anchor" href="#监控指标-系统运行状态的量化表征"><span>监控指标：系统运行状态的量化表征</span></a></h3><p>监控指标是可观察性的基础，它通过量化的方式表征系统的运行状态。服务网格自动收集丰富的监控指标，为系统性能分析和故障诊断提供数据支撑。</p><h4 id="核心监控指标" tabindex="-1"><a class="header-anchor" href="#核心监控指标"><span>核心监控指标</span></a></h4><p><strong>流量指标</strong><br> 流量指标反映了服务间的通信情况，是评估系统健康状况的重要指标。</p><p><em>请求数量</em>：统计单位时间内处理的请求数量，包括成功请求和失败请求。<br><em>响应时间</em>：测量请求从发送到接收响应的总时间，反映系统的响应性能。<br><em>错误率</em>：统计失败请求占总请求数量的比例，反映系统的稳定性。<br><em>吞吐量</em>：单位时间内处理的请求数量，反映系统的处理能力。</p><p><strong>资源使用指标</strong><br> 资源使用指标反映了系统资源的消耗情况，帮助识别性能瓶颈。</p><p><em>CPU使用率</em>：测量CPU资源的使用情况，识别CPU密集型操作。<br><em>内存使用量</em>：统计内存资源的使用情况，识别内存泄漏问题。<br><em>网络I/O</em>：测量网络数据的传输量，识别网络瓶颈。<br><em>磁盘I/O</em>：统计磁盘读写操作，识别存储性能问题。</p><p><strong>服务质量指标</strong><br> 服务质量指标反映了系统的整体服务质量，是用户体验的重要体现。</p><p><em>成功率</em>：成功请求占总请求数量的比例，反映系统的可靠性。<br><em>延迟分布</em>：请求响应时间的分布情况，识别性能异常。<br><em>可用性</em>：系统正常运行的时间比例，反映系统的稳定性。<br><em>饱和度</em>：系统资源的使用程度，反映系统的负载情况。</p><h4 id="指标收集机制" tabindex="-1"><a class="header-anchor" href="#指标收集机制"><span>指标收集机制</span></a></h4><p>服务网格通过Sidecar代理自动收集监控指标，无需修改应用程序代码。</p><p><strong>自动注入</strong><br> Sidecar代理自动注入到服务实例中，拦截所有网络流量并收集相关指标。</p><p><strong>标准化格式</strong><br> 使用标准化的指标格式，便于与其他监控系统集成。</p><p><strong>实时收集</strong><br> 实时收集指标数据，确保监控信息的时效性。</p><p><strong>配置示例</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">telemetry.istio.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Telemetry</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mesh-default</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  metrics</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">providers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="指标可视化" tabindex="-1"><a class="header-anchor" href="#指标可视化"><span>指标可视化</span></a></h4><p>通过可视化界面展示监控指标，帮助快速理解系统状态。</p><p><strong>仪表板</strong><br> 提供丰富的仪表板组件，包括折线图、柱状图、饼图等。</p><p><strong>实时监控</strong><br> 实时更新监控数据，及时发现系统异常。</p><p><strong>历史数据分析</strong><br> 分析历史数据，识别系统趋势和模式。</p><p><strong>告警集成</strong><br> 与告警系统集成，自动触发告警。</p><h3 id="日志管理-系统行为的详细记录" tabindex="-1"><a class="header-anchor" href="#日志管理-系统行为的详细记录"><span>日志管理：系统行为的详细记录</span></a></h3><p>日志是系统行为的详细记录，为故障排查和安全审计提供重要信息。服务网格提供统一的日志管理功能，简化了日志收集和分析的复杂性。</p><h4 id="结构化日志" tabindex="-1"><a class="header-anchor" href="#结构化日志"><span>结构化日志</span></a></h4><p>结构化日志采用标准化的格式，便于机器解析和分析。</p><p><strong>日志格式</strong><br> 采用JSON等结构化格式，包含时间戳、服务名、请求ID等标准字段。</p><p><strong>上下文信息</strong><br> 记录请求的上下文信息，包括源服务、目标服务、请求方法等。</p><p><strong>错误详情</strong><br> 详细记录错误信息，包括错误码、错误描述、堆栈跟踪等。</p><p><strong>配置示例</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">telemetry.istio.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Telemetry</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mesh-default</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  accessLogging</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">providers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">envoy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="日志收集机制" tabindex="-1"><a class="header-anchor" href="#日志收集机制"><span>日志收集机制</span></a></h4><p>服务网格通过Sidecar代理自动收集日志信息。</p><p><strong>自动收集</strong><br> Sidecar代理自动收集服务实例的日志信息。</p><p><strong>过滤机制</strong><br> 支持日志过滤，只收集必要的日志信息。</p><p><strong>格式化处理</strong><br> 对日志进行格式化处理，确保日志的一致性。</p><p><strong>批量发送</strong><br> 批量发送日志，减少网络开销。</p><h4 id="日志存储与检索" tabindex="-1"><a class="header-anchor" href="#日志存储与检索"><span>日志存储与检索</span></a></h4><p>提供高效的日志存储和检索能力。</p><p><strong>长期存储</strong><br> 支持日志的长期存储，满足合规要求。</p><p><strong>索引优化</strong><br> 对日志建立索引，提高检索效率。</p><p><strong>查询语言</strong><br> 提供强大的查询语言，支持复杂的日志查询。</p><p><strong>聚合分析</strong><br> 支持日志的聚合分析，识别系统模式。</p><h3 id="分布式追踪-请求流转的完整视图" tabindex="-1"><a class="header-anchor" href="#分布式追踪-请求流转的完整视图"><span>分布式追踪：请求流转的完整视图</span></a></h3><p>分布式追踪是理解微服务调用链的关键工具，它通过为每个请求生成唯一的追踪ID，并在服务间传递这个ID，从而构建完整的调用链。</p><h4 id="追踪原理" tabindex="-1"><a class="header-anchor" href="#追踪原理"><span>追踪原理</span></a></h4><p><strong>追踪ID生成</strong><br> 为每个请求生成全局唯一的追踪ID。</p><p><strong>跨度（Span）</strong><br> 记录请求在每个服务中的处理过程，包括开始时间、结束时间、操作名称等。</p><p><strong>上下文传播</strong><br> 在服务间传递追踪上下文，确保调用链的完整性。</p><p><strong>数据收集</strong><br> 收集追踪数据，构建完整的调用链视图。</p><h4 id="追踪数据结构" tabindex="-1"><a class="header-anchor" href="#追踪数据结构"><span>追踪数据结构</span></a></h4><p><strong>追踪（Trace）</strong><br> 表示一个完整的请求处理过程，包含多个跨度。</p><p><strong>跨度（Span）</strong><br> 表示请求在单个服务中的处理过程，包含操作名称、开始时间、结束时间等。</p><p><strong>引用关系</strong><br> 表示跨度间的父子关系，构建调用链结构。</p><p><strong>注解（Annotation）</strong><br> 为跨度添加额外的信息，如事件时间点、日志信息等。</p><h4 id="追踪实现" tabindex="-1"><a class="header-anchor" href="#追踪实现"><span>追踪实现</span></a></h4><p>服务网格通过Sidecar代理实现分布式追踪。</p><p><strong>自动注入</strong><br> Sidecar代理自动注入追踪代码，无需修改应用程序。</p><p><strong>标准协议</strong><br> 支持OpenTelemetry、Zipkin、Jaeger等标准追踪协议。</p><p><strong>采样策略</strong><br> 支持灵活的采样策略，平衡追踪精度和性能开销。</p><p><strong>配置示例</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">telemetry.istio.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Telemetry</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mesh-default</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  tracing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">providers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;otel&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="追踪可视化" tabindex="-1"><a class="header-anchor" href="#追踪可视化"><span>追踪可视化</span></a></h4><p>通过可视化界面展示追踪数据，帮助理解系统行为。</p><p><strong>调用链视图</strong><br> 以时间轴形式展示请求在各个服务间的流转。</p><p><strong>性能分析</strong><br> 分析调用链中的性能瓶颈，识别慢服务。</p><p><strong>错误定位</strong><br> 快速定位导致请求失败的服务。</p><p><strong>依赖关系</strong><br> 分析服务间的依赖关系，识别系统架构问题。</p><h3 id="可观察性集成" tabindex="-1"><a class="header-anchor" href="#可观察性集成"><span>可观察性集成</span></a></h3><p>服务网格与主流的可观察性工具深度集成。</p><h4 id="prometheus集成" tabindex="-1"><a class="header-anchor" href="#prometheus集成"><span>Prometheus集成</span></a></h4><p>Prometheus是云原生生态系统中最流行的监控系统。</p><p><strong>指标暴露</strong><br> 通过标准的Prometheus指标格式暴露监控数据。</p><p><strong>服务发现</strong><br> 自动发现Prometheus监控目标。</p><p><strong>告警规则</strong><br> 支持Prometheus告警规则定义。</p><p><strong>配置示例</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">monitoring.coreos.com/v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ServiceMonitor</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">istio-component-monitor</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  selector</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    matchExpressions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">istio</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">operator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">In</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pilot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  endpoints</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">http-monitoring</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="grafana集成" tabindex="-1"><a class="header-anchor" href="#grafana集成"><span>Grafana集成</span></a></h4><p>Grafana是流行的可视化和分析平台。</p><p><strong>仪表板模板</strong><br> 提供预定义的Grafana仪表板模板。</p><p><strong>数据源集成</strong><br> 支持多种数据源集成。</p><p><strong>自定义视图</strong><br> 支持自定义仪表板视图。</p><h4 id="jaeger集成" tabindex="-1"><a class="header-anchor" href="#jaeger集成"><span>Jaeger集成</span></a></h4><p>Jaeger是流行的分布式追踪系统。</p><p><strong>追踪数据收集</strong><br> 自动收集Jaeger追踪数据。</p><p><strong>查询接口</strong><br> 提供标准的Jaeger查询接口。</p><p><strong>UI集成</strong><br> 与Jaeger UI深度集成。</p><h3 id="可观察性最佳实践" tabindex="-1"><a class="header-anchor" href="#可观察性最佳实践"><span>可观察性最佳实践</span></a></h3><h4 id="指标设计原则" tabindex="-1"><a class="header-anchor" href="#指标设计原则"><span>指标设计原则</span></a></h4><p><strong>业务相关性</strong><br> 指标应与业务目标相关，能够反映业务健康状况。</p><p><strong>可操作性</strong><br> 指标应能够指导具体的操作，如扩容、优化等。</p><p><strong>可解释性</strong><br> 指标应易于理解，能够清楚地表达系统状态。</p><p><strong>可测量性</strong><br> 指标应能够准确测量，避免模糊不清的定义。</p><h4 id="日志管理策略" tabindex="-1"><a class="header-anchor" href="#日志管理策略"><span>日志管理策略</span></a></h4><p><strong>结构化日志</strong><br> 采用结构化日志格式，便于机器解析。</p><p><strong>日志级别</strong><br> 合理使用不同的日志级别，控制日志量。</p><p><strong>上下文信息</strong><br> 在日志中包含足够的上下文信息。</p><p><strong>保留策略</strong><br> 制定合理的日志保留策略，平衡存储成本和合规要求。</p><h4 id="追踪采样策略" tabindex="-1"><a class="header-anchor" href="#追踪采样策略"><span>追踪采样策略</span></a></h4><p><strong>采样率控制</strong><br> 根据系统负载和性能要求设置合适的采样率。</p><p><strong>重要请求优先</strong><br> 优先追踪重要请求，如用户关键操作。</p><p><strong>错误请求追踪</strong><br> 确保错误请求被完整追踪。</p><p><strong>动态调整</strong><br> 根据系统状态动态调整采样策略。</p><h3 id="高级可观察性功能" tabindex="-1"><a class="header-anchor" href="#高级可观察性功能"><span>高级可观察性功能</span></a></h3><h4 id="自定义指标" tabindex="-1"><a class="header-anchor" href="#自定义指标"><span>自定义指标</span></a></h4><p>支持定义自定义指标，满足特定业务需求。</p><p><strong>指标定义</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">telemetry.istio.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Telemetry</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">custom-metrics</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  metrics</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">overrides</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tagOverrides</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        custom_tag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;request.host&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    providers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="告警策略" tabindex="-1"><a class="header-anchor" href="#告警策略"><span>告警策略</span></a></h4><p>建立完善的告警策略，及时发现系统异常。</p><p><strong>告警规则</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">monitoring.coreos.com/v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PrometheusRule</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">service-mesh-alerts</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  groups</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">service-mesh.rules</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    rules</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">alert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">HighErrorRate</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      expr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">rate(istio_requests_total{response_code=~&quot;5.*&quot;}[5m]) &gt; 0.05</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">10m</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      labels</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        severity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">critical</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      annotations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        summary</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;High error rate detected&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="性能分析" tabindex="-1"><a class="header-anchor" href="#性能分析"><span>性能分析</span></a></h4><p>提供深入的性能分析功能。</p><p><strong>延迟分析</strong><br> 分析请求延迟的分布情况。</p><p><strong>瓶颈识别</strong><br> 识别系统性能瓶颈。</p><p><strong>优化建议</strong><br> 提供性能优化建议。</p><h3 id="可观察性监控与运维" tabindex="-1"><a class="header-anchor" href="#可观察性监控与运维"><span>可观察性监控与运维</span></a></h3><h4 id="关键可观察性指标" tabindex="-1"><a class="header-anchor" href="#关键可观察性指标"><span>关键可观察性指标</span></a></h4><p><strong>系统健康指标</strong></p><ul><li>服务可用性</li><li>请求成功率</li><li>系统响应时间</li></ul><p><strong>资源使用指标</strong></p><ul><li>CPU和内存使用率</li><li>网络带宽使用</li><li>存储空间使用</li></ul><p><strong>业务指标</strong></p><ul><li>业务请求量</li><li>业务成功率</li><li>业务响应时间</li></ul><h4 id="监控告警策略" tabindex="-1"><a class="header-anchor" href="#监控告警策略"><span>监控告警策略</span></a></h4><p><strong>分级告警</strong></p><ul><li>信息性告警：系统状态变化</li><li>警告性告警：潜在问题</li><li>严重告警：系统故障</li></ul><p><strong>告警抑制</strong></p><ul><li>避免告警风暴</li><li>关联告警抑制</li><li>时间窗口抑制</li></ul><p><strong>告警通知</strong></p><ul><li>多渠道通知</li><li>告警升级机制</li><li>告警确认机制</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>可观察性是服务网格的核心功能之一，通过监控指标、日志管理和分布式追踪等机制，为微服务架构提供了全面的系统洞察能力。合理配置和使用这些可观察性功能，可以显著提高系统的可维护性和可靠性。</p><p>在实际应用中，需要根据具体的业务场景和运维需求，选择合适的可观察性策略，并与主流的可观察性工具深度集成。通过实施结构化日志、合理设计监控指标、优化追踪采样策略等最佳实践，可以最大化可观察性的价值。</p><p>随着云原生技术的不断发展，服务网格的可观察性功能将继续演进，为构建更加智能和高效的分布式系统提供更好的支持。通过建立完善的监控告警体系、实施有效的日志管理策略、优化追踪采样机制，可以确保系统在提供强大功能的同时，也具备足够的可观察性保障。</p>`,138)])])}const k=i(l,[["render",p]]),d=JSON.parse('{"path":"/posts/service-mesh/1-3-3_Observability-Monitoring-Logging-Tracing.html","title":"可观察性：监控、日志与追踪的全方位洞察","lang":"zh-CN","frontmatter":{"title":"可观察性：监控、日志与追踪的全方位洞察","date":"2025-08-30T00:00:00.000Z","categories":["Service Mesh"],"tags":["service-mesh"],"published":true,"description":"可观察性：监控、日志与追踪的全方位洞察 在复杂的微服务架构中，系统的可观察性是确保系统稳定运行和快速故障排查的关键。服务网格通过提供全面的可观察性功能，包括监控指标、日志收集和分布式追踪，帮助运维人员和开发者深入了解系统的运行状态。本章将深入探讨这些可观察性功能的实现原理、配置方法以及最佳实践。 监控指标：系统运行状态的量化表征 监控指标是可观察性的基...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"可观察性：监控、日志与追踪的全方位洞察\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-08-30T00:00:00.000Z\\",\\"dateModified\\":\\"2025-09-01T13:27:06.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"老马啸西风\\",\\"url\\":\\"https://houbb.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://houbb.github.io/blog-micro-service/posts/service-mesh/1-3-3_Observability-Monitoring-Logging-Tracing.html"}],["meta",{"property":"og:site_name","content":"老马啸西风"}],["meta",{"property":"og:title","content":"可观察性：监控、日志与追踪的全方位洞察"}],["meta",{"property":"og:description","content":"可观察性：监控、日志与追踪的全方位洞察 在复杂的微服务架构中，系统的可观察性是确保系统稳定运行和快速故障排查的关键。服务网格通过提供全面的可观察性功能，包括监控指标、日志收集和分布式追踪，帮助运维人员和开发者深入了解系统的运行状态。本章将深入探讨这些可观察性功能的实现原理、配置方法以及最佳实践。 监控指标：系统运行状态的量化表征 监控指标是可观察性的基..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-01T13:27:06.000Z"}],["meta",{"property":"article:tag","content":"service-mesh"}],["meta",{"property":"article:published_time","content":"2025-08-30T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-01T13:27:06.000Z"}]]},"git":{"createdTime":1756698707000,"updatedTime":1756733226000,"contributors":[{"name":"binbin.hou","username":"","email":"binbin.hou@huifu.com","commits":1},{"name":"bbhou","username":"bbhou","email":"1557740299@qq.com","commits":1,"url":"https://github.com/bbhou"}]},"readingTime":{"minutes":9.64,"words":2893},"filePathRelative":"posts/service-mesh/1-3-3_Observability-Monitoring-Logging-Tracing.md","excerpt":"<h2>可观察性：监控、日志与追踪的全方位洞察</h2>\\n<p>在复杂的微服务架构中，系统的可观察性是确保系统稳定运行和快速故障排查的关键。服务网格通过提供全面的可观察性功能，包括监控指标、日志收集和分布式追踪，帮助运维人员和开发者深入了解系统的运行状态。本章将深入探讨这些可观察性功能的实现原理、配置方法以及最佳实践。</p>\\n<h3>监控指标：系统运行状态的量化表征</h3>\\n<p>监控指标是可观察性的基础，它通过量化的方式表征系统的运行状态。服务网格自动收集丰富的监控指标，为系统性能分析和故障诊断提供数据支撑。</p>\\n<h4>核心监控指标</h4>\\n<p><strong>流量指标</strong><br>\\n流量指标反映了服务间的通信情况，是评估系统健康状况的重要指标。</p>","autoDesc":true}');export{k as comp,d as data};
